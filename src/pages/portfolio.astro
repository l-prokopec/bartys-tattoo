---
import BaseLayout from '../layouts/BaseLayout.astro';
import type { ImageMetadata } from 'astro';

const trashPolkaImages = Object.values(
  import.meta.glob<{ default: ImageMetadata }>(
    '../assets/portfolio/trash-polka/*.{png,jpg,jpeg,webp,avif}',
    { eager: true }
  )
);

const realismImages = Object.values(
  import.meta.glob<{ default: ImageMetadata }>(
    '../assets/portfolio/realistica/*.{png,jpg,jpeg,webp,avif}',
    { eager: true }
  )
);
---


<BaseLayout title="Bartys Tattoo - Portfolio">
  <section class="portfolio-section">
    
    <!-- Trash Polka -->
    <article class="portfolio-style">
      <header class="portfolio-style__header">
        <h1>Trash Polka</h1>
        <h2>Chaos a harmonie v jednom</h2>
      </header>

      <div class="portfolio-style__body">
        <div class="portfolio-description" data-expanded="false">
          <p>
            Trash Polka je výrazný a provokativní tetovací styl, který vznikl v Německu, ve studiu Buena Vista Tattoo
            Club (Simone Pfaff a Volko Merschky). Kombinuje realistické motivy s abstraktními prvky, často ve formě
            šmouh, skvrn, nápisů a geometrických tvarů. Typické je pro něj použití pouze černé a červené barvy, což
            vytváří silný kontrast a dramatický vizuální dojem.
          </p>
          <p>
            Styl Trash Polka působí, jako by byl „roztrhaný“ nebo „kolážovitý“ – spojuje krásu a zmatek, realitu a
            fikci, život a smrt. Často nese hluboké osobní nebo filozofické významy, které jsou podané ve vizuálně
            explozivní formě.
          </p>
        </div>

        <button class="portfolio-toggle" type="button">
          Více
        </button>

                <div class="portfolio-gallery">
          <button
            class="portfolio-gallery__arrow portfolio-gallery__arrow--prev"
            type="button"
            aria-label="Předchozí obrázek"
          >
            ←
          </button>

          <div class="portfolio-gallery__track">
            {trashPolkaImages.map((image, index) => (
              <figure class="portfolio-gallery__item">
                <img
                  src={image.default.src}
                  alt={`Trash Polka tetování ${index + 1}`}
                  loading="lazy"
                  class="portfolio-gallery__image"
                />
              </figure>
            ))}
          </div>

          <button
            class="portfolio-gallery__arrow portfolio-gallery__arrow--next"
            type="button"
            aria-label="Další obrázek"
          >
            →
          </button>
        </div>
      </div>
    </article>

    <!-- Realistika zvířat -->
    <article class="portfolio-style">
      <header class="portfolio-style__header">
        <h1>Realistika zvířat</h1>
        <h2>Síla přírody zachycená v inkoustu</h2>
      </header>

      <div class="portfolio-style__body">
        <div class="portfolio-description" data-expanded="false">
          <p>
            Tetování ve stylu realistiky zvířat se zaměřuje na co nejvěrnější zobrazení živých tvorů – od jemných
            detailů srsti a lesku v očích až po hru světla a stínu. Cílem je vytvořit tetování, které působí jako
            živé, s důrazem na emocionalitu, charakter a energii daného zvířete.
          </p>
          <p>
            Realistická zvířata se často používají jako symbol síly, svobody, věrnosti nebo instinktů, které si člověk
            spojuje se svým vlastním příběhem. Každé tetování je originál, který přenáší osobnost i duši zvířete přímo
            na kůži.
          </p>
        </div>

        <button class="portfolio-toggle" type="button">
          Více
        </button>

                <div class="portfolio-gallery">
          <button
            class="portfolio-gallery__arrow portfolio-gallery__arrow--prev"
            type="button"
            aria-label="Předchozí obrázek"
          >
            ←
          </button>

          <div class="portfolio-gallery__track">
            {realismImages.map((image, index) => (
              <figure class="portfolio-gallery__item">
                <img
                  src={image.default.src}
                  alt={`Realistické tetování ${index + 1}`}
                  loading="lazy"
                  class="portfolio-gallery__image"
                />
              </figure>
            ))}
          </div>

          <button
            class="portfolio-gallery__arrow portfolio-gallery__arrow--next"
            type="button"
            aria-label="Další obrázek"
          >
            →
          </button>
        </div>
      </div>
    </article>
  </section>

    <script is:inline>
    document.addEventListener('DOMContentLoaded', function () {
      // --- Rozbalování / sbalování textu ---
      document.querySelectorAll('.portfolio-style').forEach(function (section) {
        var description = section.querySelector('.portfolio-description');
        var toggleButton = section.querySelector('.portfolio-toggle');

        if (!description || !toggleButton) return;
        if (!(description instanceof HTMLElement)) return;
        if (!(toggleButton instanceof HTMLButtonElement)) return;

        var releasePress = function () {
          toggleButton.classList.remove('is-pressed');
        };

        toggleButton.addEventListener('pointerdown', function () {
          toggleButton.classList.add('is-pressed');
        });
        ['pointerup', 'pointerleave', 'pointercancel', 'blur'].forEach(function (eventName) {
          toggleButton.addEventListener(eventName, releasePress);
        });

        toggleButton.addEventListener('click', function () {
          var isExpanded = description.dataset.expanded === 'true';
          description.dataset.expanded = isExpanded ? 'false' : 'true';
          toggleButton.textContent = isExpanded ? 'Více' : 'Méně';
          releasePress();
        });
      });

      // --- Galerie (nekonečná smyčka + "depth" efekt pro sousedy) ---
      function getCenteredScrollLeft(trackEl, itemEl) {
        return itemEl.offsetLeft - (trackEl.clientWidth - itemEl.clientWidth) / 2;
      }

      function jumpToItem(trackEl, itemEl) {
        trackEl.scrollLeft = getCenteredScrollLeft(trackEl, itemEl);
      }

      function scrollToItem(trackEl, itemEl) {
        trackEl.scrollTo({
          left: getCenteredScrollLeft(trackEl, itemEl),
          behavior: 'smooth'
        });
      }

      function initGallery(gallery) {
        if (!(gallery instanceof HTMLElement)) return;
        if (gallery.dataset.galleryReady === 'true') return;

        var track = gallery.querySelector('.portfolio-gallery__track');
        var prevBtn = gallery.querySelector('.portfolio-gallery__arrow--prev');
        var nextBtn = gallery.querySelector('.portfolio-gallery__arrow--next');

        if (!track || !(track instanceof HTMLElement)) return;

        var items = Array.prototype.slice
          .call(track.querySelectorAll('.portfolio-gallery__item'))
          .filter(function (el) {
            return el instanceof HTMLElement;
          });

        if (items.length <= 1) {
          if (prevBtn) prevBtn.setAttribute('hidden', 'true');
          if (nextBtn) nextBtn.setAttribute('hidden', 'true');
          gallery.dataset.galleryReady = 'true';
          return;
        }

        var ticking = false;
        var activeIndex = 0;
        function updateArrows() {
          if (!(prevBtn instanceof HTMLButtonElement) || !(nextBtn instanceof HTMLButtonElement)) return;
          // Hide arrows on the true ends (first/last image), independent of padding/scroll math.
          if (activeIndex <= 0) prevBtn.setAttribute('hidden', 'true');
          else prevBtn.removeAttribute('hidden');

          if (activeIndex >= items.length - 1) nextBtn.setAttribute('hidden', 'true');
          else nextBtn.removeAttribute('hidden');
        }

        function updateActive() {
          var center = track.scrollLeft + track.clientWidth / 2;
          var closestIndex = 0;
          var minDistance = Infinity;

          for (var i = 0; i < items.length; i++) {
            var item = items[i];
            var itemCenter = item.offsetLeft + item.clientWidth / 2;
            var distance = Math.abs(center - itemCenter);
            if (distance < minDistance) {
              minDistance = distance;
              closestIndex = i;
            }
          }

          items.forEach(function (item) {
            item.classList.remove('is-active', 'is-left', 'is-right');
          });

          var active = items[closestIndex];
          if (!active) return;

          activeIndex = closestIndex;
          active.classList.add('is-active');
          if (items[closestIndex - 1]) items[closestIndex - 1].classList.add('is-left');
          if (items[closestIndex + 1]) items[closestIndex + 1].classList.add('is-right');
        }

        function requestTick() {
          if (ticking) return;
          ticking = true;
          requestAnimationFrame(function () {
            ticking = false;
            updateActive();
            updateArrows();
          });
        }

        function scrollByItem(direction) {
          var active = track.querySelector('.portfolio-gallery__item.is-active');
          var currentIndex = items.indexOf(active);
          if (currentIndex === -1) currentIndex = 0;
          var target = items[currentIndex + direction];
          if (!(target instanceof HTMLElement)) return;
          scrollToItem(track, target);
        }

        if (prevBtn instanceof HTMLButtonElement) {
          prevBtn.removeAttribute('hidden');
          prevBtn.addEventListener('click', function () {
            scrollByItem(-1);
          });
        }

        if (nextBtn instanceof HTMLButtonElement) {
          nextBtn.removeAttribute('hidden');
          nextBtn.addEventListener('click', function () {
            scrollByItem(1);
          });
        }

        track.addEventListener('scroll', requestTick, { passive: true });
        window.addEventListener('resize', requestTick);

        requestAnimationFrame(function () {
          updateActive();
          updateArrows();
        });

        gallery.dataset.galleryReady = 'true';
      }

      document.querySelectorAll('.portfolio-gallery').forEach(initGallery);
    });
  </script>
</BaseLayout>
